<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<canvas id="wrap" height="800" width="800"></canvas>
<script>
    var interval = 10;
    var count = 360/interval;
    var wrap = document.getElementById("wrap");
    var ctx = wrap.getContext("2d");
    ctx.lineJoin = "round";
    ctx.lineCap = "round";
    ctx.lineWidth = 10;
    ctx.globalAlpha = 0.7;
    // ctx.
    var R = 200;

    var center = [300, 300];
    var nodes = new Array();
    //创建数据
    var output = new Uint8Array(count);

    var AudioContext = AudioContext || webkitAudioContext;
    var context = new AudioContext;
    //加载媒体
    var audio = new Audio("static/piano.mp3");
    //创建节点
    var source = context.createMediaElementSource(audio);
    var analyser = context.createAnalyser();
    //连接：source → analyser → destination
    source.connect(analyser);
    analyser.connect(context.destination);

    var AudioContext2 = AudioContext || webkitAudioContext;
    var context2 = new AudioContext2;
    var audio2 = new Audio("static/guitar.mp3");
    var source2 = context2.createMediaElementSource(audio2);
    var analyser2 = context2.createAnalyser();
    source2.connect(analyser2);
    analyser2.connect(context2.destination);
    var output2 = new Uint8Array(count);

    audio.play();audio2.play();
    (function draw(){
        analyser.getByteFrequencyData(output);
        ctx.clearRect(0, 0, wrap.width, wrap.height);
        ctx.strokeStyle="#3250ff";
        ctx.beginPath();

        for(var i = 0; i < count; i++){
            nodes[i] = new Array();
            var delX = output[i]/3;
            var delY = output[i]/3;
            nodes[i][0] = Math.cos(i*interval/180 * Math.PI)*(R - delX) + center[0];
            nodes[i][1] = Math.sin(i*interval/180 * Math.PI)*(R - delY) + center[1];
        }
        for(var i = 0; i < count; i++){
            if(i == 0) {
                ctx.moveTo(nodes[i][0], nodes[i][1]);
            } else {
                ctx.quadraticCurveTo(nodes[i%count][0], nodes[i%count][1], (nodes[(i+1)%count][0] + nodes[i%count][0])/2, (nodes[(i+1)%count][1]+nodes[i%count][1])/2);
            }

        }

        ctx.quadraticCurveTo(nodes[0][0], nodes[0][1], (nodes[1][0]+nodes[0][0])/2 , (nodes[1][1]+nodes[0][1])/2);
        ctx.stroke();

        analyser2.getByteFrequencyData(output2);
        ctx.strokeStyle="#ff5091";
        ctx.beginPath();

        for(var i = 0; i < count; i++){
            var delX = output2[i]/3;
            var delY = output2[i]/3;
            nodes[i][0] = Math.cos(i*interval/180 * Math.PI)*(R - delX) + center[0];
            nodes[i][1] = Math.sin(i*interval/180 * Math.PI)*(R - delY) + center[1];
        }
        for(var i = 0; i < count; i++){
            if(i == 0) {
                ctx.moveTo(nodes[i][0], nodes[i][1]);
            } else {
                ctx.quadraticCurveTo(nodes[i%count][0], nodes[i%count][1], (nodes[(i+1)%count][0] + nodes[i%count][0])/2, (nodes[(i+1)%count][1]+nodes[i%count][1])/2);
            }

        }

        ctx.quadraticCurveTo(nodes[0][0], nodes[0][1], (nodes[1][0]+nodes[0][0])/2 , (nodes[1][1]+nodes[0][1])/2);
        ctx.stroke();

        requestAnimationFrame(draw);
    })();


</script>
</body>
</html>